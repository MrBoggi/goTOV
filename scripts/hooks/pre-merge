#!/bin/sh

echo "ğŸ” Running pre-merge checks..."

# Conflict markers
if git grep -n '<<<<<<<' -- .; then
    echo "âŒ Merge conflict markers found"
    exit 1
fi

echo "â–¶ Checking build..."
if ! go build ./...; then
    echo "âŒ Build failed"
    exit 1
fi

echo "â–¶ Checking gofmt..."
unformatted=$(gofmt -l .)
if [ -n "$unformatted" ]; then
    echo "âŒ Unformatted files:"
    echo "$unformatted"
    exit 1
fi

echo "â–¶ Running go vet..."
if ! go vet ./...; then
    echo "âŒ go vet failed"
    exit 1
fi

echo "â–¶ Running golangci-lint..."
if ! golangci-lint run; then
    echo "âŒ Linter issues"
    exit 1
fi

echo "âœ… Pre-merge checks passed."
exit 0
